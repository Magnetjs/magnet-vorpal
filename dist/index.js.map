{"version":3,"sources":["../src/index.js"],"names":[],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;;;IAEqB,Y;;;;;;;;;;;;;;;YAIX,U,EAKA,Q;;;;;;AAPN,qBAAK,GAAL,CAAS,MAAT,GAAkB,uBAAlB;;AAEM,0B,GAAa,eAAK,OAAL,CACjB,QAAQ,GAAR,EADiB,EAEjB,KAAK,MAAL,CAAY,WAAZ,IAA2B,iBAFV,C;AAKb,wB,GAAW,0BAAW,UAAX,C;;;;;;;sBAEN,G;;AACT,sBAAI,CAAC,uBAAQ,SAAS,GAAT,CAAR,CAAD,IAA2B,SAAS,GAAT,EAAc,OAA7C,EAAsD;AACpD,6BAAS,GAAT,IAAgB,SAAS,GAAT,EAAc,OAA9B;AACA,wBAAM,OAAO,SAAS,GAAT,EAAc,OAAd,IAAyB,GAAtC;;;;AAIA,wBAAI,UAAU,OAAK,GAAL,CAAS,MAAT,CAAgB,OAAhB,CAAwB,IAAxB,CAAd;;AAEA,wBAAI,SAAS,GAAT,EAAc,OAAlB,EAA2B;AAAA;AAAA;AAAA;;AAAA;AACzB,8CAAmB,SAAS,GAAT,EAAc,OAAjC,mIAA0C;AAAA,8BAAjC,MAAiC;;AACxC,kCAAQ,MAAR,CAAe,KAAf,CAAqB,OAArB,EAA8B,MAA9B;AACD;AAHwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAI1B;;AAED,wBAAI,iBAAiB,CACnB,OADmB,EAEnB,cAFmB,EAGnB,aAHmB,EAInB,MAJmB,EAKnB,QALmB,EAMnB,OANmB,EAOnB,UAPmB,CAArB;AAdoD;AAAA;AAAA;;AAAA;AAuBpD,4CAA4B,cAA5B,mIAA4C;AAAA,4BAAjC,aAAiC;;AAC1C,4BAAI,SAAS,GAAT,EAAc,aAAd,CAAJ,EAAkC;AAChC,kCAAQ,aAAR,EAAuB,SAAS,GAAT,EAAc,aAAd,CAAvB;AACD;AACF;AA3BmD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA6BpD,wBAAI,mBAAmB,CAAC,QAAD,EAAW,QAAX,CAAvB;AA7BoD;AAAA;AAAA;;AAAA;AAAA;AAAA,4BA8BzC,eA9ByC;;AA+BlD,4BAAI,SAAS,GAAT,EAAc,eAAd,CAAJ,EAAoC;AAClC,kCAAQ,eAAR;AAAA,gFAAyB,iBAAO,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6CACV,SAAS,GAAT,EAAc,eAAd,EAA+B,IAA/B,SAA0C,OAAK,GAA/C,EAAoD,IAApD,CADU;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAAzB;;AAAA;AAAA;AAAA;AAAA;AAGD;AAnCiD;;AA8BpD,4CAA8B,gBAA9B,mIAAgD;AAAA;AAM/C;AApCmD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAqCrD;;;AAtCH,iCAAkB,OAAO,IAAP,CAAY,QAAZ,CAAlB,uHAAyC;AAAA;AAuCxC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAID,qBAAK,GAAL,CAAS,MAAT,CACG,SADH,CACa,GADb,EAEG,IAFH;;;;;;;;;;;;;;;;;;;;;kBAtDiB,Y","file":"index.js","sourcesContent":["import Base from 'magnet-core/dist/base';\nimport Vorpal from 'vorpal';\nimport path from 'path';\nimport requireAll from 'require-all';\nimport isEmpty from 'lodash/isEmpty';\nimport defaultConfig from './config/vorpal';\n\nexport default class VorpalMagnet extends Base {\n  async setup() {\n    this.app.vorpal = Vorpal();\n\n    const folderPath = path.resolve(\n      process.cwd(),\n      this.config.commandPath || 'server/commands'\n    );\n\n    const commands = requireAll(folderPath);\n\n    for (const key of Object.keys(commands)) {\n      if (!isEmpty(commands[key]) && commands[key].default) {\n        commands[key] = commands[key].default;\n        const name = commands[key].command || key;\n\n        // Apply vorpal config\n        // https://github.com/dthree/vorpal/wiki/api-%7C-vorpal.command#api\n        let command = this.app.vorpal.command(name);\n\n        if (commands[key].options) {\n          for (let option of commands[key].options) {\n            command.option.apply(command, option);\n          }\n        }\n\n        let commonCommands = [\n          'alias',\n          'autocomplete',\n          'description',\n          'help',\n          'hidden',\n          'types',\n          'validate',\n        ];\n        for (const commonCommand of commonCommands) {\n          if (commands[key][commonCommand]) {\n            command[commonCommand](commands[key][commonCommand]);\n          }\n        }\n\n        let functionCommands = ['action', 'cancel'];\n        for (const functionCommand of functionCommands) {\n          if (commands[key][functionCommand]) {\n            command[functionCommand](async (args) => {\n              return await commands[key][functionCommand].call(this, this.app, args);\n            });\n          }\n        }\n      }\n    }\n  }\n\n  async start() {\n    this.app.vorpal\n      .delimiter('$')\n      .show();\n  }\n}\n"]}